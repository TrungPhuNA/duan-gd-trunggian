<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Ng∆∞·ªùi Mua - SafeTrade</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">SafeTrade</div>
                <div class="user-info">
                    <div class="user-details">
                        <div class="user-name">ƒêang t·∫£i...</div>
                        <div class="user-role" style="font-size: 12px; opacity: 0.8;">Ng∆∞·ªùi mua</div>
                    </div>
                    <div class="user-avatar">üë§</div>
                    <button class="btn btn-secondary" onclick="App.User.logout()" style="margin-left: 12px; padding: 8px 16px; font-size: 14px;">ƒêƒÉng xu·∫•t</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="nav">
        <div class="container">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="buyer-dashboard.html" class="nav-link active">Trang ch·ªß</a>
                </li>
                <li class="nav-item">
                    <a href="create-transaction.html" class="nav-link">T·∫°o giao d·ªãch</a>
                </li>
                <li class="nav-item">
                    <a href="rooms.html" class="nav-link">Ph√≤ng GD</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterTransactions('all')">T·∫•t c·∫£</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterTransactions('pending')">ƒêang ch·ªù</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="filterTransactions('completed')">Ho√†n t·∫•t</a>
                </li>
                <li class="nav-item">
                    <a href="my-disputes.html" class="nav-link">Khi·∫øu n·∫°i</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container" style="padding-bottom: 80px;">
        <!-- Stats Cards -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin: 24px 0;">
            <div class="card">
                <div class="card-body text-center">
                    <div style="font-size: 24px; font-weight: bold; color: #007BFF;" id="totalTransactions">0</div>
                    <div style="font-size: 14px; color: #666;">T·ªïng giao d·ªãch</div>
                </div>
            </div>
            <div class="card">
                <div class="card-body text-center">
                    <div style="font-size: 24px; font-weight: bold; color: #28a745;" id="completedTransactions">0</div>
                    <div style="font-size: 14px; color: #666;">Ho√†n th√†nh</div>
                </div>
            </div>
            <div class="card">
                <div class="card-body text-center">
                    <div style="font-size: 24px; font-weight: bold; color: #ffc107;" id="pendingTransactions">0</div>
                    <div style="font-size: 14px; color: #666;">ƒêang ch·ªù</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-24">
            <div class="card-header">Thao t√°c nhanh</div>
            <div class="card-body">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
                    <a href="create-transaction.html" class="btn btn-primary">
                        ‚ûï T·∫°o giao d·ªãch m·ªõi
                    </a>
                    <a href="rooms.html" class="btn btn-secondary">
                        üè¢ Xem ph√≤ng GD
                    </a>
                </div>
            </div>
        </div>

        <!-- Transactions List -->
        <div class="card">
            <div class="card-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Giao d·ªãch c·ªßa t√¥i</span>
                    <select id="statusFilter" class="form-control" style="width: auto; min-width: 150px;" onchange="filterTransactions(this.value)">
                        <option value="all">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="PENDING_SELLER">Ch·ªù x√°c nh·∫≠n</option>
                        <option value="PENDING_PAYMENT">Ch·ªù thanh to√°n</option>
                        <option value="PAID">ƒê√£ thanh to√°n</option>
                        <option value="SHIPPING">ƒêang giao</option>
                        <option value="COMPLETED">Ho√†n t·∫•t</option>
                        <option value="DISPUTED">Tranh ch·∫•p</option>
                    </select>
                </div>
            </div>
            <div class="card-body" style="padding: 0;">
                <div id="transactionsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>ƒêang t·∫£i giao d·ªãch...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="buyer-dashboard.html" class="bottom-nav-item active">
            <span class="bottom-nav-icon">üè†</span>
            <span>Trang ch·ªß</span>
        </a>
        <a href="create-transaction.html" class="bottom-nav-item">
            <span class="bottom-nav-icon">‚ûï</span>
            <span>T·∫°o m·ªõi</span>
        </a>
        <a href="rooms.html" class="bottom-nav-item">
            <span class="bottom-nav-icon">üè¢</span>
            <span>Ph√≤ng GD</span>
        </a>
        <a href="my-disputes.html" class="bottom-nav-item">
            <span class="bottom-nav-icon">‚ö†Ô∏è</span>
            <span>Khi·∫øu n·∫°i</span>
        </a>
    </nav>

    <script src="js/app.js"></script>
    <script>
        let currentFilter = 'all';
        let allTransactions = [];

        function loadTransactions() {
            const user = App.User.getCurrentUser();
            if (!user) return;

            allTransactions = App.Transaction.getByUser(user.id, 'buyer');
            updateStats();
            renderTransactions(allTransactions);
        }

        function updateStats() {
            const total = allTransactions.length;
            const completed = allTransactions.filter(t => t.status === 'COMPLETED').length;
            const pending = allTransactions.filter(t => 
                ['PENDING_SELLER', 'PENDING_PAYMENT', 'PAID', 'SHIPPING'].includes(t.status)
            ).length;

            document.getElementById('totalTransactions').textContent = total;
            document.getElementById('completedTransactions').textContent = completed;
            document.getElementById('pendingTransactions').textContent = pending;
        }

        function renderTransactions(transactions) {
            const container = document.getElementById('transactionsList');
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: #666;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üìù</div>
                        <p>Ch∆∞a c√≥ giao d·ªãch n√†o</p>
                        <a href="create-transaction.html" class="btn btn-primary mt-16">T·∫°o giao d·ªãch ƒë·∫ßu ti√™n</a>
                    </div>
                `;
                return;
            }

            const html = transactions.map(transaction => `
                <div class="transaction-item" onclick="viewTransaction('${transaction.id}')">
                    <div class="transaction-header">
                        <div class="transaction-id">#${transaction.id}</div>
                        <div class="transaction-amount">${App.Utils.formatCurrency(transaction.amount)}</div>
                    </div>
                    <div class="transaction-details">
                        <strong>${transaction.productName}</strong><br>
                        Ng∆∞·ªùi b√°n: ${transaction.sellerName} - ${transaction.sellerPhone}
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                        <span class="status-badge ${getStatusClass(transaction.status)}">
                            ${getStatusText(transaction.status)}
                        </span>
                        <span style="font-size: 12px; color: #999;">
                            ${App.Utils.formatDate(transaction.updatedAt)}
                        </span>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }

        function getStatusClass(status) {
            const statusClasses = {
                'PENDING_SELLER': 'status-pending',
                'PENDING_PAYMENT': 'status-pending',
                'PAID': 'status-paid',
                'SHIPPING': 'status-shipping',
                'COMPLETED': 'status-completed',
                'DISPUTED': 'status-disputed'
            };
            return statusClasses[status] || 'status-pending';
        }

        function getStatusText(status) {
            return App.CONFIG.TRANSACTION_STATUSES[status] || status;
        }

        function filterTransactions(filter) {
            currentFilter = filter;
            
            let filteredTransactions = allTransactions;
            
            if (filter !== 'all') {
                if (filter === 'pending') {
                    filteredTransactions = allTransactions.filter(t => 
                        ['PENDING_SELLER', 'PENDING_PAYMENT', 'PAID', 'SHIPPING'].includes(t.status)
                    );
                } else if (filter === 'completed') {
                    filteredTransactions = allTransactions.filter(t => t.status === 'COMPLETED');
                } else {
                    filteredTransactions = allTransactions.filter(t => t.status === filter);
                }
            }
            
            renderTransactions(filteredTransactions);
            
            // Update filter select
            document.getElementById('statusFilter').value = filter;
        }

        function viewTransaction(transactionId) {
            window.location.href = `transaction-detail.html?id=${transactionId}`;
        }

        function refreshTransactions() {
            App.Utils.showLoading(document.getElementById('transactionsList'));
            setTimeout(() => {
                loadTransactions();
                filterTransactions(currentFilter);
            }, 1000);
        }

        function showProfile() {
            const user = App.User.getCurrentUser();
            alert(`Th√¥ng tin t√†i kho·∫£n:\nT√™n: ${user.name}\nSƒêT: ${user.phone}\nVai tr√≤: Ng∆∞·ªùi mua`);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            const user = App.User.getCurrentUser();
            if (user) {
                document.querySelector('.user-name').textContent = user.name;
                loadTransactions();
            }
        });
    </script>
</body>
</html>
